<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>BNK Board - View</title>
</head>
<body>

<h1>게시글 상세</h1>

<div id="content"></div>

<hr>

<button onclick="goEdit()">수정</button>
<button onclick="softDelete()">삭제</button>
<button onclick="location.href='index.html'">목록</button>

<script src="assets/js/storage.js"></script>
<script src="assets/js/util.js"></script>
<script>
  const id = Number(Util.qs("id"));
  const boards = StorageDB.get("BOARD", []);
  const stats  = StorageDB.get("BOARD_STAT", []);

  const board = boards.find(b => b.id === id);
  if (!board || board.status === "DELETED") {
    alert("존재하지 않는 게시글입니다.");
    location.href = "index.html";
  }

  // 조회수 증가
  const stat = stats.find(s => s.board_id === id);
  if (stat) {
    stat.view_count++;
    StorageDB.set("BOARD_STAT", stats);
  }

  document.getElementById("content").innerHTML = `
    <h2>${Util.escapeHtml(board.title)}</h2>
    <p>${Util.escapeHtml(board.content)}</p>
    <p>상태: ${board.status}</p>
    <p>작성일: ${Util.fmt(board.created_at)}</p>
    <p>수정일: ${Util.fmt(board.updated_at)}</p>
  `;

  function goEdit() {
    location.href = `edit.html?id=${id}`;
  }

  function softDelete() {
    if (!confirm("삭제 처리하시겠습니까?")) return;
    board.status = "DELETED";
    board.updated_at = new Date().toISOString();
    StorageDB.set("BOARD", boards);
    alert("삭제되었습니다.");
    location.href = "index.html";
  }
</script>

</body>
</html>
